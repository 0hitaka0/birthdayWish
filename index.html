<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Inezia‚Äôs Birthday Quest ‚Ä¢ Sweet & Salty</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
  :root{
    --bg:#080915;
    --panel:#151640;
    --panel-dark:#0d0e2a;
    --fg:#f8f8ff;
    --muted:#7f90d6;
    --accent:#ff6ac1;
    --accent-2:#7afff4;
    --accent-dark:#ff3f9c;
    --good:#7bff69;
    --bad:#ff6d6d;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:'Press Start 2P','VT323',monospace;font-size:13px;letter-spacing:.6px}
  body{background-image:linear-gradient(rgba(255,255,255,.05) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.05) 1px,transparent 1px);background-size:32px 32px,32px 32px}
  .wrap{min-height:100%;display:grid;place-items:center;padding:32px}
  .card{width:min(900px,96vw);background:var(--panel);border:4px solid #2a2c70;box-shadow:0 20px 50px rgba(0,0,0,.6);image-rendering:pixelated}
  header{display:flex;gap:18px;align-items:center;justify-content:space-between;padding:20px;background:var(--panel-dark);border-bottom:4px solid #2a2c70}
  .badges{display:flex;gap:14px;flex-wrap:wrap}
  .badge{background:#202365;border:4px solid #2a2c70;padding:10px 14px;box-shadow:4px 4px 0 #030312;text-transform:uppercase}
  .cta{display:flex;gap:14px}
  button{appearance:none;border:4px solid #030312;border-radius:0;padding:12px 18px;font-weight:900;cursor:pointer;background:var(--accent);color:#030312;box-shadow:4px 4px 0 #030312;text-transform:uppercase;transition:transform .12s ease,box-shadow .12s ease}
  button:hover{transform:translate(-3px,-3px);box-shadow:7px 7px 0 #030312}
  button:active{transform:translate(0,0);box-shadow:3px 3px 0 #030312}
  button.secondary{background:var(--accent-2);color:#051b1c}
  button[disabled]{background:#3c3e70;color:#0f1030;cursor:not-allowed;box-shadow:4px 4px 0 #030312;opacity:.7}
  main{padding:26px;display:grid;gap:22px}
  .screen{display:none}
  .screen.active{display:block}
  .title{font-size:clamp(16px,2.8vw,24px);margin:0 0 10px;text-transform:uppercase}
  .sub{color:var(--muted);margin:0 0 14px;line-height:1.6}
  .panel{background:var(--panel-dark);border:4px solid #2a2c70;box-shadow:6px 6px 0 #030312;padding:20px;image-rendering:pixelated}
  .center{display:grid;place-items:center;text-align:center}
  .stage{display:grid;gap:20px}

  /* Tic Tac Toe */
  .ttt{width:min(360px,90vw);aspect-ratio:1;display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:0 auto}
  .ttt button{background:#202365;border:4px solid #030312;color:var(--fg);font-size:38px;box-shadow:4px 4px 0 #030312}
  .ttt button:focus{outline:none;box-shadow:0 0 0 4px rgba(255,255,255,.35)}
  .ttt .win{background:#2f3480;color:#7afff4}

  /* Sudoku */
  .sudoku{display:grid;gap:16px}
  .grid4{display:grid;grid-template-columns:repeat(4,60px);gap:12px;justify-content:center}
  .grid4 input{width:60px;height:60px;text-align:center;font-size:28px;border:4px solid #030312;background:#1b1d54;color:var(--fg);font-family:'Press Start 2P','VT323',monospace}
  .grid4 input.block{background:#10123a;color:#7afff4}
  .grid4 input:focus{outline:none;box-shadow:0 0 0 4px rgba(122,255,244,.45)}
  .err{color:var(--bad)}
  .ok{color:var(--good)}

  /* Boss */
  .boss{display:grid;gap:18px}
  .croc{display:grid;grid-template-columns:150px 1fr;gap:18px;align-items:center}
  @media (max-width:680px){.croc{grid-template-columns:1fr;text-align:center}}
  .croc .face{width:150px;height:150px;background:linear-gradient(180deg,#3dd671,#1f8a46);border:4px solid #030312;position:relative;box-shadow:6px 6px 0 #030312}
  .eye{position:absolute;top:38px;width:26px;height:26px;background:#fff;border:4px solid #030312;border-radius:50%}
  .eye.left{left:32px}.eye.right{right:32px}
  .pupil{position:absolute;top:6px;left:6px;width:12px;height:12px;background:#030312;border-radius:50%}
  .teeth{position:absolute;bottom:10px;left:18px;right:18px;height:22px;display:flex;justify-content:space-between}
  .teeth span{width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:14px solid #fff;filter:drop-shadow(2px 2px 0 rgba(0,0,0,.3))}
  .speech{background:#1b1d54;border:4px solid #030312;padding:14px;box-shadow:4px 4px 0 #030312}
  .qte{display:flex;gap:12px;flex-wrap:wrap}
  .qte button{background:#1b1d54;color:var(--fg);box-shadow:4px 4px 0 #030312}
  .qte button.good{background:var(--good);color:#030312}

  /* Gift */
  .gift{display:grid;place-items:center;gap:18px;padding:14px}
  .box{width:150px;height:110px;background:linear-gradient(180deg,var(--accent),var(--accent-2));border:4px solid #030312;box-shadow:6px 6px 0 #030312;position:relative}
  .box:before{content:"";position:absolute;left:50%;top:-26px;transform:translateX(-50%);width:108px;height:36px;background:linear-gradient(180deg,var(--accent-2),var(--accent-dark));border:4px solid #030312;box-shadow:4px 4px 0 #030312}
  .ribbon{position:absolute;left:50%;transform:translateX(-50%);top:-6px;width:20px;height:124px;background:#f5f5ff}

  /* Popup */
  .popup{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:24px;z-index:1000}
  .popup.active{display:flex}
  .popup-backdrop{position:absolute;inset:0;background:rgba(8,9,21,.82);backdrop-filter:blur(4px)}
  .popup-card{position:relative;width:min(360px,90vw);text-align:center}
  body.popup-open{overflow:hidden}
</style>
</head>
<body>
  <audio id="bgm" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_74f76b0361.mp3?filename=balloons-rising-116861.mp3" preload="auto" loop></audio>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="badges">
          <span class="badge" id="lvl">Level 1</span>
          <span class="badge">Player: <b style="margin-left:6px">Inezia</b></span>
        </div>
        <div class="cta">
          <button id="restart" class="secondary">Restart</button>
        </div>
      </header>

      <main>
        <section id="screen-intro" class="screen active">
          <div class="panel center">
            <h2 class="title">Sweet & Salty: Inezia‚Äôs Birthday Quest</h2>
            <p class="sub">Three pixel missions stand between you and the manipulative crocodile. Summon Kia, shut down the lies, and unlock your birthday surprise.</p>
            <div class="gift" style="margin:18px 0">
              <div class="box"><span class="ribbon"></span></div>
              <p class="sub">A neon present is waiting‚Ä¶</p>
            </div>
            <button id="start">Start Adventure</button>
          </div>
        </section>

        <section id="screen-ttt" class="screen">
          <div class="panel stage">
            <div class="center">
              <h3 class="title">Level 1 ¬∑ Tic Tac Toe</h3>
              <p class="sub">Beat the yap-happy bot in a single swoop. Tap one square and the game bends in your favor.</p>
              <div id="tttBoard" class="ttt"></div>
              <p id="tttMsg" class="sub"></p>
              <div class="cta" style="justify-content:center"><button id="tttReset" class="secondary">Restart Level</button></div>
            </div>
            <div class="panel">
              <h4 class="title">Yapbot says‚Ä¶</h4>
              <div id="yapLines" class="speech">‚ÄúI‚Äôm not annoying, I‚Äôm just efficient at talking.‚Äù</div>
            </div>
          </div>
        </section>

        <section id="screen-sudoku" class="screen">
          <div class="panel stage">
            <div class="center">
              <h3 class="title">Level 2 ¬∑ Mini Sudoku</h3>
              <p class="sub">Place digits 1‚Äì4 without repeats in any row or column. Solve the neon grid to reach the boss.</p>
              <div class="sudoku">
                <div id="sGrid" class="grid4"></div>
                <div class="cta" style="justify-content:center">
                  <button id="checkSudoku">Check</button>
                  <button id="newSudoku" class="secondary">New Puzzle</button>
                </div>
                <p id="sMsg" class="sub"></p>
              </div>
            </div>
            <div class="panel">
              <h4 class="title">Retro Tip</h4>
              <p class="sub">Lock the givens, scan rows and columns, and let your brain glitch the crocodile‚Äôs plans.</p>
            </div>
          </div>
        </section>

        <section id="screen-boss" class="screen">
          <div class="panel boss">
            <h3 class="title">Final Boss ¬∑ Manipulative Crocodile üêä</h3>
            <div class="croc">
              <div class="face">
                <div class="eye left"><div class="pupil"></div></div>
                <div class="eye right"><div class="pupil"></div></div>
                <div class="teeth"><span></span><span></span><span></span><span></span></div>
              </div>
              <div>
                <div id="crocLine" class="speech">‚ÄúWhy listen to anyone else when I‚Äôm always right?‚Äù</div>
                <p class="sub">Ping Kia to shield your heart, then smash three lies in a row to win.</p>
                <div class="cta" style="flex-wrap:wrap">
                  <button id="callKia">Call Kia</button>
                  <button id="block1" class="secondary" disabled>Block 1</button>
                  <button id="block2" class="secondary" disabled>Block 2</button>
                  <button id="block3" class="secondary" disabled>Block 3</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section id="screen-end" class="screen center">
          <div class="panel center">
            <h3 class="title">Victory! ‚ú®</h3>
            <p class="sub">Kia & Inezia settle in the glow of pixel skies, ready to unwrap the surprise together.</p>
            <div class="gift">
              <div class="box" id="giftBox"><span class="ribbon"></span></div>
              <p id="giftMsg" class="sub">Tap the gift</p>
            </div>
            <div id="wish" class="panel" style="display:none; margin-top:16px">
              <h3 class="title">Happy Birthday, Inezia üíô</h3>
              <p class="sub">You‚Äôre the brightest glitch in every timeline‚Äîclever, hilarious, and impossible not to adore. May your year be epic, safe, and sprinkled with the sweetest adventures. ‚Äî Kia</p>
              <div class="cta" style="justify-content:center"><button id="playAgain">Play Again</button></div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <div id="popup" class="popup" role="dialog" aria-modal="true" aria-labelledby="popupTitle" aria-describedby="popupMsg">
    <div class="popup-backdrop"></div>
    <div class="panel popup-card">
      <h3 class="title" id="popupTitle"></h3>
      <p class="sub" id="popupMsg"></p>
      <div class="cta" style="justify-content:center"><button id="popupBtn">Continue</button></div>
    </div>
  </div>

<script>
const state = {
  level: 1,
  ttt:{ board:Array(9).fill(null), score:{me:0}, rounds:0, matchOver:false, moves:0 },
  sudoku:{},
  boss:{ ready:false, blocks:0 },
  progress:{ ttt:false, sudoku:false, boss:false },
  victoryUnlocked:false
};

const bgm = document.getElementById('bgm');
let musicStarted = false;
function playSong(){
  if(musicStarted) return;
  bgm.volume = 0.6;
  const playPromise = bgm.play();
  if(playPromise && typeof playPromise.then === 'function'){
    playPromise.then(()=>{ musicStarted = true; }).catch(()=>{});
  } else {
    musicStarted = true;
  }
}
window.addEventListener('load',()=>{ setTimeout(()=> playSong(), 200); });
document.addEventListener('pointerdown', playSong, { once:true });

const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);
function show(id){
  if(id==='#screen-end' && !state.victoryUnlocked){ return; }
  $$('.screen').forEach(s=>s.classList.remove('active'));
  $(id).classList.add('active');
  updateHUD();
}
function updateHUD(){
  const label = typeof state.level === 'number' ? `Level ${state.level}` : state.level;
  $('#lvl').textContent = label;
}

const popupEl = $('#popup');
const popupBtn = $('#popupBtn');
function showPopup({ title, message, buttonText = 'Continue', onConfirm }){
  $('#popupTitle').textContent = title;
  $('#popupMsg').textContent = message;
  popupBtn.textContent = buttonText;
  popupBtn.onclick = () => {
    hidePopup();
    if(typeof onConfirm === 'function'){ onConfirm(); }
  };
  popupEl.classList.add('active');
  document.body.classList.add('popup-open');
  setTimeout(()=> popupBtn.focus(), 80);
}
function hidePopup(){
  popupEl.classList.remove('active');
  document.body.classList.remove('popup-open');
}

$('#start').addEventListener('click',()=>{
  playSong();
  state.level=1;
  state.progress.ttt=false;
  state.progress.sudoku=false;
  state.progress.boss=false;
  state.victoryUnlocked=false;
  updateHUD();
  initTTT();
  show('#screen-ttt');
});
$('#restart').addEventListener('click',()=>{ location.reload(); });

const yapLines = [
  "I‚Äôm not overthinking‚ÄîI‚Äôm just thinking twice.",
  "If I lose, it‚Äôs a growth mindset moment.",
  "Beep boop, strategic yap engaged.",
  "Your move looks delicious."
];
function sayYap(){ $('#yapLines').textContent = `‚Äú${yapLines[Math.floor(Math.random()*yapLines.length)]}‚Äù`; }

function initTTT(){
  state.ttt.board = Array(9).fill(null); state.ttt.rounds=0; state.ttt.score.me=0; state.ttt.matchOver=false; state.ttt.moves=0;
  const board = $('#tttBoard'); board.innerHTML='';
  for(let i=0;i<9;i++){
    const cell = document.createElement('button');
    cell.dataset.idx=i;
    cell.addEventListener('click', onTTTClick);
    board.appendChild(cell);
  }
  $('#tttMsg').textContent = 'Quick warm-up ‚Äî tap any square to trigger the win!';
  $('#tttReset').textContent = 'Restart Level';
  $('#tttReset').onclick = ()=> resetTTTRound();
  sayYap();
}
function resetTTTRound(){
  if(state.ttt.matchOver){ initTTT(); return; }
  state.ttt.board = Array(9).fill(null); state.ttt.moves=0;
  $$('#tttBoard button').forEach(c=>{c.textContent=''; c.classList.remove('win'); c.disabled=false;});
  $('#tttMsg').textContent='New round!';
  sayYap();
}
function onTTTClick(e){
  const idx = +e.currentTarget.dataset.idx; if(state.ttt.board[idx]) return;
  move(idx);
  state.ttt.moves++;
  if(state.ttt.moves===1){ grantFirstTryWin(idx); return; }
  if(checkWin()){ endRound(); }
}
function move(idx){ state.ttt.board[idx]='X'; const btn = $$('#tttBoard button')[idx]; btn.textContent='X'; btn.disabled=true; }
const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
function checkWin(){
  for(const w of wins){ if(w.every(i=>state.ttt.board[i]==='X')){ w.forEach(i=> $$('#tttBoard button')[i].classList.add('win')); return true; } }
  return false;
}
const autoWins = {
  0:[1,2],1:[0,2],2:[0,1],
  3:[4,5],4:[0,8],5:[3,4],
  6:[7,8],7:[6,8],8:[6,7]
};
function grantFirstTryWin(firstMove){
  const helpers = autoWins[firstMove] || [0,1];
  helpers.forEach(i=>{ if(state.ttt.board[i]===null){ move(i); } });
  checkWin();
  endRound();
}
function endRound(){
  state.ttt.matchOver = true;
  $$('#tttBoard button').forEach(b=> b.disabled=true);
  $('#tttMsg').textContent = 'Victory! Yapbot short-circuited.';
  $('#tttReset').textContent = 'Play Again';
  state.progress.ttt = true;
  showPopup({
    title: 'Level 1 Clear!',
    message: 'Yapbot is stunned by your instant win. Ready for a neon-brained Sudoku?',
    buttonText: 'Continue to Level 2',
    onConfirm: ()=>{ state.level=2; updateHUD(); initSudoku(); show('#screen-sudoku'); }
  });
}

const presetPuzzles = [
  [0,0,2,0,  0,0,0,1,  0,4,0,0,  3,0,0,0],
  [1,0,0,0,  0,3,0,4,  0,0,4,0,  0,2,0,1],
  [0,2,0,0,  0,0,3,0,  0,1,0,4,  0,0,0,0]
];
function initSudoku(){
  const grid = $('#sGrid'); grid.innerHTML='';
  state.sudoku.solution = gen4x4Solution();
  state.sudoku.puzzle = carvePuzzle(state.sudoku.solution);
  state.sudoku.cleared = false;
  for(let i=0;i<16;i++){
    const input = document.createElement('input');
    if(state.sudoku.puzzle[i]!==0){ input.value = state.sudoku.puzzle[i]; input.disabled=true; input.classList.add('block'); }
    input.maxLength=1; input.inputMode='numeric';
    input.addEventListener('input', e=>{ e.target.value = e.target.value.replace(/[^1-4]/g,''); });
    grid.appendChild(input);
  }
  $('#sMsg').textContent='';
  $('#checkSudoku').disabled=false;
  $('#newSudoku').disabled=false;
}
function gen4x4Solution(){
  const base=[1,2,3,4];
  const rows=[ base, rotate(base,1), rotate(base,2), rotate(base,3) ];
  const shuffle = arr => arr.sort(()=>Math.random()-0.5);
  const rOrder = shuffle([0,1,2,3]);
  const cOrder = shuffle([0,1,2,3]);
  const out=[];
  for(let r=0;r<4;r++){
    for(let c=0;c<4;c++){
      out.push(rows[rOrder[r]][cOrder[c]]);
    }
  }
  return out;
}
function rotate(arr,n){ return arr.slice(n).concat(arr.slice(0,n)); }
function carvePuzzle(sol){
  const mask = presetPuzzles[Math.floor(Math.random()*presetPuzzles.length)].slice();
  const puzzle = mask.map((v,i)=> v ? sol[i] : 0);
  const indexes=[...Array(16).keys()];
  indexes.sort(()=>Math.random()-0.5).slice(0,3).forEach(i=> puzzle[i]=0);
  return puzzle;
}
$('#newSudoku').addEventListener('click', initSudoku);
$('#checkSudoku').addEventListener('click', ()=>{
  if(state.sudoku.cleared) return;
  const values=[...$('#sGrid').querySelectorAll('input')].map(inp=> +inp.value || 0);
  if(!isValid(values)){ $('#sMsg').innerHTML = '<span class="err">Not quite ‚Äî recheck each row and column.</span>'; return; }
  state.sudoku.cleared = true;
  state.progress.sudoku = true;
  $('#sMsg').innerHTML = '<span class="ok">Solved! Final stage unlocked.</span>';
  $('#checkSudoku').disabled=true;
  $('#newSudoku').disabled=true;
  showPopup({
    title: 'Level 2 Clear!',
    message: 'Brains blazing! Time to face the manipulative crocodile with Kia at your side.',
    buttonText: 'Final Boss ‚Üí',
    onConfirm: ()=>{ state.level=3; updateHUD(); initBoss(); show('#screen-boss'); }
  });
});
function isValid(vals){
  if(vals.some(v=> v<1 || v>4)) return false;
  for(let r=0;r<4;r++){
    const row = vals.slice(r*4,(r+1)*4);
    if(new Set(row).size!==4) return false;
  }
  for(let c=0;c<4;c++){
    const col = [vals[c],vals[c+4],vals[c+8],vals[c+12]];
    if(new Set(col).size!==4) return false;
  }
  return true;
}

const crocLines=[
  "If they cared, they‚Äôd read your mind.",
  "Sharing is losing. Keep it all.",
  "You‚Äôre overreacting‚Äîagain.",
  "You owe me your silence.",
  "Your feelings are just glitches."
];
function initBoss(){
  state.boss.ready=false; state.boss.blocks=0;
  state.progress.boss = false;
  state.victoryUnlocked = false;
  $('#callKia').disabled=false;
  ['block1','block2','block3'].forEach(id=>{
    const btn = $('#'+id);
    btn.disabled=true;
    btn.classList.remove('good');
  });
  nextCrocLine();
}
function nextCrocLine(){ $('#crocLine').textContent = `‚Äú${crocLines[Math.floor(Math.random()*crocLines.length)]}‚Äù`; }
$('#callKia').addEventListener('click',()=>{
  state.boss.ready=true;
  $('#callKia').disabled=true;
  $('#crocLine').textContent = 'Kia: ‚ÄúForce-field online. Tap three blocks to shatter the lies!‚Äù';
  ['block1','block2','block3'].forEach(id=> $('#'+id).disabled=false);
});
['block1','block2','block3'].forEach(id=>{
  $('#'+id).addEventListener('click',()=>{
    if(!state.boss.ready) return;
    const btn = $('#'+id);
    if(btn.classList.contains('good')) return;
    btn.classList.add('good');
    btn.disabled=true;
    state.boss.blocks++;
    nextCrocLine();
    if(state.boss.blocks>=3){
      state.progress.boss = true;
      revealVictory();
    }
  });
});

function revealVictory(){
  if(!(state.progress.ttt && state.progress.sudoku && state.progress.boss)) return;
  state.victoryUnlocked = true;
  state.level = 'Victory!';
  $$('.screen').forEach(s=>s.classList.remove('active'));
  $('#screen-end').classList.add('active');
  updateHUD();
}

$('#giftBox').addEventListener('click',()=>{
  $('#giftMsg').textContent = 'üíå Opened';
  $('#wish').style.display='block';
});
$('#playAgain').addEventListener('click',()=> location.reload());
</script>
</body>
</html>
